<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment - Dusty Shelf</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="hero d-flex align-items-center">
    <div class="container">
      <h1 class="display-6 fw-bold text-uppercase mb-1">Payment</h1>
      <p class="lead mb-0">Enter UPI details and confirm your purchase</p>
    </div>
  </header>

  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html"><i class="fa-solid fa-book"></i></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="index.html">Home</a>
          <a class="nav-link" href="books.html">Books</a>
          <a class="nav-link" href="cart.html">Cart</a>
        </div>
      </div>
    </div>
  </nav>

  <main class="py-4">
    <div class="container">
      <div id="payment-section" class="card shadow-sm mb-4">
        <div class="card-body">
          <h2 class="h5">Enter Payment UPI ID</h2>
          <p class="mb-2">Books Selected:</p>
          <ul id="book-list" class="list-group mb-3"></ul>
          <p class="fw-semibold">Total Amount: $<span id="total-amount">0</span></p>
          <div class="input-group mb-3">
            <span class="input-group-text">UPI</span>
            <input type="text" id="payment-url" class="form-control" placeholder="Enter UPI ID (e.g., 7075682352@ybl)">
          </div>
          <p><a id="payment-link" href="#" target="_blank" style="display:none;">Click here to Pay</a></p>
          <p id="error-message" class="text-danger" style="display:none;">Please enter a valid UPI ID (e.g., 7075682352@ybl)</p>
          <div class="d-flex gap-2">
            <button id="updateBtn" class="btn btn-outline-primary">Update Payment Details</button>
            <button id="proceedBtn" class="btn btn-success">Proceed to Payment</button>
            <a href="cart.html" class="btn btn-outline-secondary">Back to Cart</a>
          </div>
        </div>
      </div>

      <div id="bill-section" class="card shadow-sm" style="display:none;">
        <div class="card-body">
          <h2 class="h5">Bill Receipt</h2>
          <p>Thank you for your purchase!</p>
          <p class="mb-1">Books Purchased:</p>
          <ul id="bill-book-list" class="list-group mb-3"></ul>
          <p>Total Amount Paid: $<span id="bill-amount"></span></p>
          <p>Transaction ID: <span id="transaction-id"></span></p>
          <a href="index.html" class="btn btn-primary">Go to Home</a>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="f-info">
        <div class="f-info-social">
          <a href="https://facebook.com" target="_blank" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
          <a href="https://instagram.com" target="_blank" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
          <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
        </div>
        <div>&copy; Wunderlust Private Limited</div>
        <div class="f-info-links">
          <a href="/privacy">Privacy</a>
          <a href="/terms">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function getCart(){
      try { return JSON.parse(localStorage.getItem('cart')) || []; } catch { return []; }
    }

    function loadCart(){
      const cartItems = getCart();
      if(cartItems.length === 0){
        document.getElementById('book-list').innerHTML = '<li class="list-group-item">Your cart is empty.</li>';
        document.getElementById('total-amount').innerText = '0';
        return;
      }
      const totalAmount = cartItems.reduce((sum, item) => sum + (Number(item.price) || 0), 0);
      document.getElementById('total-amount').innerText = totalAmount;
      const bookList = document.getElementById('book-list');
      bookList.innerHTML = '';
      cartItems.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<span>${item.name}</span><span class="text-muted">$${item.price}</span>`;
        bookList.appendChild(li);
      });
    }

    function updatePaymentDetails(){
      const paymentUrl = document.getElementById('payment-url').value.trim();
      const paymentLink = document.getElementById('payment-link');
      const errorMessage = document.getElementById('error-message');
      const upiRegex = /^[0-9]{10}@\w+$/;
      if(upiRegex.test(paymentUrl)){
        paymentLink.href = `upi://${paymentUrl}`;
        paymentLink.style.display = 'inline';
        errorMessage.style.display = 'none';
      } else {
        errorMessage.style.display = 'block';
        paymentLink.style.display = 'none';
      }
    }

    function showReceipt(){
      const cartItems = getCart();
      if(cartItems.length === 0){
        alert('Your cart is empty.');
        return;
      }
      const totalAmount = cartItems.reduce((sum, item) => sum + (Number(item.price) || 0), 0);
      const transactionId = 'TXN' + Math.floor(Math.random() * 1000000);

      const billBookList = document.getElementById('bill-book-list');
      billBookList.innerHTML = '';
      cartItems.forEach(item => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<span>${item.name}</span><span class="text-muted">$${item.price}</span>`;
        billBookList.appendChild(li);
      });

      document.getElementById('bill-amount').innerText = totalAmount;
      document.getElementById('transaction-id').innerText = transactionId;

      document.getElementById('payment-section').style.display = 'none';
      document.getElementById('bill-section').style.display = 'block';

      localStorage.removeItem('cart');
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCart();
      document.getElementById('updateBtn').addEventListener('click', updatePaymentDetails);
      document.getElementById('proceedBtn').addEventListener('click', showReceipt);
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
